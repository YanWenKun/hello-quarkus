= ä½ å¥½ï¼ŒQuarkusï¼

å‚è€ƒï¼š
https://quarkus.io/guides/getting-started

== å‰

.ç”Ÿæˆé¡¹ç›®
[source,bash]
----
mvn io.quarkus:quarkus-maven-plugin:1.4.2.Final:create \
    -DprojectGroupId=fun.yanwk.helloquarkus \
    -DprojectArtifactId=hello-world \
    -DclassName="fun.yanwk.helloquarkus.helloworld.GreetingResource" \
    -Dpath="/hello"
cd hello-quarkus
----

.è¿è¡Œé¡¹ç›®ï¼ˆå¼€å‘æ—¶çƒ­æ›´æ–°ï¼‰
[source,bash]
----
./mvnw quarkus:dev
----

Quarkus çš„çƒ­æ›´æ–°æ˜¯ç›®å‰ä¸ªäººä½“éªŒè¿‡æœ€çˆ½çš„ã€‚

== ä¸­

.ä½ å¥½ï¼Œä¸–ç•Œ
[source,java]
----
/**
 * 1. åœ¨ Quarkus ä¸­ï¼Œç‹¬åˆ›å»ºä¸€ä¸ª Application ç±»å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚
 * 2. åœ¨ Quarkus ä¸­ï¼Œä¸€ä¸ªèµ„æºï¼ˆRESTæœ¯è¯­ï¼‰åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªã€‚
 * 3. ä½ å¯ä»¥ç”¨ *Scoped æ³¨è§£æ¥é…ç½®å®ä¾‹çš„åˆ›å»ºå…³æ³¨ç‚¹ã€‚
 */
@Path("/hello")
public class GreetingResource {

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "ä½ å¥½ï¼Œä¸–ç•Œï¼"; // é»˜è®¤å³æ— ä¹±ç 
    }
}

----

è™½ç„¶â€œè½»é‡â€ï¼Œä½†æ²¡æœ‰è½»åˆ°ä¸­æ–‡ä¹±ç ã€‚æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼ŒåŠ åˆ†ã€‚

.ç¼–å†™ä¸€ä¸ª Service
[source,java]
----
// å¦‚æœæ³¨é‡Šæ‰è¯¥æ³¨è§£ï¼Œèƒ½æ­£å¸¸ç¼–è¯‘ï¼Œä½†å¯åŠ¨å³æŠ¥é”™ï¼Œä¹Ÿå°±è¿‡ä¸äº†å•å…ƒæµ‹è¯•
@ApplicationScoped
public class GreetingService {

    public String greeting(String name) {
        return "Hello, " + name + "!";
    }
}
----

.ä»¥ä¾èµ–æ³¨å…¥çš„å½¢å¼æ·»åŠ åˆ°èµ„æºï¼ˆæ§åˆ¶å™¨ï¼‰ä¸­
[source,java]
----
    @Inject
    GreetingService service;

    @GET
    @Path("/greeting/{name}")
    @Produces(MediaType.TEXT_PLAIN)
    public String greeting(@PathParam String name) {
        return service.greeting(name);
    }
----

.ç¼–å†™å•å…ƒæµ‹è¯•
[source,java]
----
/**
 * ä½¿ç”¨ QuarkusTest runnerï¼Œä¼šæŒ‡ç¤º JUnit å…ˆå¯åŠ¨ç¨‹åºï¼Œå†æ‰§è¡Œæµ‹è¯•
 */
@QuarkusTest
public class GreetingResourceTest {

    // REST Assured æŒºå¥½ä½¿
    @Test
    public void testHelloEndpoint() {
        given()
            .when()
                .get("/hello")
            .then()
                .statusCode(200) // HTTP OK
                .body(is("ä½ å¥½ï¼Œä¸–ç•Œï¼"));
    }

    @Test
    public void testGreetingEndpoint() {
        String uuid = UUID.randomUUID().toString();
        given()
                .pathParam("name", uuid)
            .when()
                .get("/hello/greeting/{name}")
            .then()
                .statusCode(200)
                .body(is("Hello, " + uuid + "!"));
    }

}
----

æµ‹è¯•é»˜è®¤ä¼šè·‘åœ¨ 8081 ç«¯å£ï¼Œå› æ­¤ä¸å½±å“ 8080 çš„ Web Serverã€‚

=== å¦‚ä½• Debug

. åœ¨ Intellij IDEA ä¸­æ·»åŠ ä¸€ä¸ªè¿è¡Œé…ç½®ï¼ˆRun - Edit Configurations...ï¼‰
. é€‰æ‹©â€œRemoteâ€ä½œä¸ºæ¨¡æ¿ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯
. ç°åœ¨ç”¨ IDEA å¼€å§‹ Debugï¼Œå°±èƒ½ä½¿ç”¨æ–­ç‚¹äº†

NOTE: è¿™é‡Œæœ¬è´¨ä¸Šæ˜¯ JVM è¿œç¨‹ Debugï¼Œé»˜è®¤ 5005 ç«¯å£ã€‚

[TIP]
ä¸€è·¯ Debug ä¸‹æ¥ï¼Œä¼šå‘ç°æ˜¯ Vert.x åœ¨å¤„ç†è¯·æ±‚ã€‚
å¯ä»¥éšä¾¿ç©ç©ï¼Œæ¯”å¦‚å¼€ä¸¤ä¸ª HTTP å®¢æˆ·ç«¯ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼Œçœ‹çœ‹åŒæ­¥ã€å¼‚æ­¥ã€å¤šçº¿ç¨‹å¦‚ä½•ã€‚

== å

.æ‰“åŒ…
----
./mvnw package
----

åœ¨ `target/` ä¸‹çš„ `*-runner.jar` å³æ˜¯å¯æ‰§è¡Œ jarã€‚ +
216 KiB è¿™ä¹ˆå°ï¼Œè‡ªç„¶å¯åŠ¨å¾ˆå¿«ã€‚

æ³¨æ„è¿™ä¸ªå¹¶ä¸æ˜¯ Ã¼ber-jar æˆ–è€… fat-jarï¼Œå®ƒå¹¶æ²¡æœ‰æŠŠä¾èµ–é¡¹æ‰“åŒ…è¿›æ¥ã€‚ +
å®é™…ä¸Šå®ƒçš„è¿è¡Œéœ€è¦ `target/lib/` ä¸‹çš„æ–‡ä»¶ã€‚

è¿™å¹¶ä¸æ˜¯ç¼ºç‚¹ï¼Œè¿™æ ·çš„ç»“æ„é…ä¸Š OpenJ9 èƒ½åœ¨ Docker ä¸­ç©å‡ºèŠ±æ¥â€¦â€¦è·‘å‡ºå¤§é‡å¯åŠ¨å¿«ã€å†…å­˜å ç”¨å°‘çš„å®ä¾‹ã€‚

å½“ç„¶ï¼Œå¯åŠ¨æœ€å¿«çš„è¿˜æ˜¯ GraalVM çš„ Native Imageï¼š

.åœ¨å®¹å™¨ä¸­ç”Ÿæˆ native å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆéœ€è¦å®‰è£…æœ‰ Dockerï¼‰
----
./mvnw package -Pnative -Dquarkus.native.container-build=true
----

.åœ¨å½“å‰ç¯å¢ƒä¸­ç”Ÿæˆ native å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆéœ€è¦å®‰è£…æœ‰ GraalVMï¼‰
----
./mvnw package -Pnative
----

åœ¨å½“å‰ç¯å¢ƒä¸­ç¼–è¯‘è¿˜éœ€è¦ GraalVM ä¹‹å¤–çš„ä¸€äº›æ¡ä»¶ï¼Œ
å‚è€ƒ https://quarkus.io/guides/building-native-image[å®˜æ–¹æ–‡æ¡£] ã€‚
ä¸æƒ³æŠ˜è…¾è¿˜æ˜¯ Docker å§ã€‚

åœ¨ Docker Desktop + WSL2 ä¸‹å¯ä»¥ç¼–è¯‘ï¼Œç¼–è¯‘æ—¶é—´ä¸ç®—çŸ­ï¼ˆRyzen 1700ï¼Œ2.5min+ï¼‰ã€‚

è¿™æ¬¡äº§ç‰©å°±æœ‰ 27.5 MiB äº†ï¼Œæ˜¯å®å¿ƒçš„äº†ğŸ˜„

å¯åŠ¨é€Ÿåº¦è¿™ä»¶äº‹ï¼Œé‡å˜å¼•èµ·è´¨å˜ï¼Œå½“å¿«åˆ°ç”¨æˆ·éš¾ä»¥æ„ŸçŸ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥â€œå‡½æ•°åŒ–â€äº†ï¼ŒæŒ‰éœ€å¯åŠ¨ï¼Œéšç”¨éšå¯ï¼Œè¿™å¯¹äº‘è®¡ç®—çš„æ„ä¹‰ä¸è¨€è€Œå–»ã€‚å› æ­¤â€œäº‘åŸç”Ÿâ€ç–¯ç‹‚è¿½æ±‚å¿«é€Ÿå¯åŠ¨ã€ä½å†…å­˜å ç”¨ã€‚

== è¯­è¨€ä¸å·¥å…·çš„é€‰æ‹©

* å»ºè®® Java + Maven ä¸Šæ‰‹

è™½ç„¶å®˜æ–¹å¯¹ Kotlin å’Œ Gradle å‡å‹å¥½ï¼Œä½†å¯¹ Java + Maven çš„æ”¯æŒè¶³ï¼Œå¼€å‘è€…å­¦ä¹ ã€ä¸Šæ‰‹æ—¶çš„é˜»åŠ›å°ã€‚
Kotlin çš„å¼‚æ­¥ã€Gradle çš„å¤æ‚æ„å»ºç­‰ä¼˜åŠ¿æ˜¯å¦ç”¨å¾—ä¸Šï¼Œä¸å¦‚ç­‰ç†Ÿæ‚‰äº† Quarkus å†è§†æƒ…å†µè€ƒè™‘ã€‚

ï¼ˆæœ‰äº›æ–°æ¡†æ¶å®Œå…¨å€’å‘ Gradleï¼Œè¿™ä»å•†ä¸šä¸Šæ¥çœ‹å¹¶ä¸æ˜æ™ºï¼Œä¸å¥½ç”¨ä¸å¦æ— å…³ã€‚ï¼‰

* Docker é•œåƒçš„æ„å»ºæ€è·¯

å®˜æ–¹çš„ Dockerfile å†™çš„æœ‰ç‚¹è¿·ï¼Œä¼°è®¡æ˜¯ä¸ºäº†ç”¨ `Red Hat Universal Base Image`ã€‚ä¹Ÿä¸çŸ¥â€œå¼ºåˆ¶ç»Ÿä¸€åŸºç¡€è®¾æ–½â€è¿™ç§æ€è·¯æ€ä¹ˆåšæˆäº†è¿™ä¸ªæ ·å­ï¼Œè¦ç³»ç»Ÿè§„æ¨¡å¤§åˆ°ä»€ä¹ˆç¨‹åº¦æ‰ä¼šæ›´å¯é ã€‚

æ­¤å¤–ï¼Œä¸ªäººæ›´å–œæ¬¢ç”¨ Dockerfile æ¥å®šä¹‰æ„å»ºæµç¨‹ä¸äº§ç‰©ã€‚
åŒ…æ‹¬â€œå¹²å‡€ç¼–è¯‘â€ä¹Ÿæ”¾åœ¨å®¹å™¨ä¸­è¿›è¡Œï¼Œä¿è¯äº§ç‰©çš„å¯å¤ç°æ€§ã€‚
å»ºè®®è‡ªå·±ç”¨çš„æ—¶å€™é‡å†™ Dockerfileã€‚

== å…¶ä»–æ„Ÿå—

* é«˜è´¨é‡å®˜æ–¹æ–‡æ¡£ã€‚
* ç‰ˆæœ¬æ¨è¿›è¿…çŒ›ã€‚
* æ•´å¥—æ–‡æ¡£ã€å·¥å…·é“¾é«˜åº¦å·¥ç¨‹åŒ–ï¼Œä¸Šä¸‹æ¸¸æ›´æ–°ååˆ†åŠæ—¶ã€‚
** ä¼°è®¡ä¼šç¬¬ä¸€æ—¶é—´ç”¨ä¸Š Maven 3.7 å’Œ Gradle 7ï¼ˆåŒ…æ‹¬ç›¸å…³ç»„ä»¶çš„å¤§ç‰ˆæœ¬å‡çº§ï¼‰ã€‚
* ç»†èŠ‚é«˜è´¨é‡ã€‚
** æ–°çš„å¼€å‘ä½“ç³»å¾ˆå¤šï¼Œä½†ç›®å‰åªè§åˆ° Helidon æœ‰è¿™èˆ¬è´¨é‡ï¼Œä½†å› å…¶ Oracle èƒŒæ™¯ï¼Œå¾ˆéš¾çœ‹å¥½ Helidon åœ¨å›½å†…çš„æ¨å¹¿ã€‚

æ˜“ç”¨ï¼ŒåŒ…å®¹ä¸­ä¸å¤±å…ˆè¿›ï¼Œå•†ä¸šä¸Šçš„å¹³è¡¡ï¼Œå¼ºå¤§çš„åç›¾ï¼Œ
è¿™äº›å› ç´ ä½¿ Quarkus ä½“ç³»å®Œå…¨æœ‰æ½œåŠ›å‘å±•åˆ° Spring Boot çš„é«˜åº¦ã€‚

è¿™æ¬¡ Hello World æ˜¯ä¸€åœºæ„å¤–çš„æƒŠå–œã€‚
